{{- $stories := slice -}}
{{- range .Pages -}}
  {{- $pinDays := .Params.pin_days | default 3 -}}
  {{- $pinUntil := "" -}}
  {{- with .Params.pub_date -}}
    {{- $pubDate := time.AsTime . -}}
    {{- $pinUntil = dateFormat "2006-01-02" ($pubDate.AddDate 0 0 (int $pinDays)) -}}
  {{- end -}}
  {{- $story := dict
    "title" .Title
    "url" .Params.story_url
    "source" (.Params.source | default "Manual")
    "category" (.Params.category | default "resort-operations")
    "content_type" (.Params.content_type | default "article")
    "description" (.Params.description | default "")
    "pub_date" (.Params.pub_date | default "")
    "pinned" true
    "pin_until" $pinUntil
    "active" (.Params.active | default true)
  -}}
  {{- $stories = $stories | append $story -}}
{{- end -}}
{{- dict "stories" $stories | jsonify (dict "indent" "  ") -}}
