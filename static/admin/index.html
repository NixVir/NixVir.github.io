<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>NixVir Content Manager</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <style>
    /* =============================================
       NixVir Dark Theme for DecapCMS
       Matches the site's shared-theme.css palette
       ============================================= */

    /* Core background and text */
    body {
      background: #0a0e14 !important;
      color: #e8ecf2 !important;
    }

    /* =============================================
       Header bar layout fix
       Push CMS nav to the right to make room for logo
       ============================================= */
    [class*="AppHeader"],
    header[class*="Header"] {
      background: #111820 !important;
      border-bottom: 1px solid #2a3444 !important;
      padding-left: 210px !important;
    }
    [class*="AppHeader"] a,
    [class*="AppHeader"] span,
    [class*="AppHeader"] div,
    header a, header span, header div {
      color: #e8ecf2 !important;
    }

    /* Editor toolbar bar (back arrow + "Writing in..." + Save) */
    [class*="EditorToolbar"],
    [class*="editorToolbar"] {
      padding-left: 210px !important;
      background: #111820 !important;
      border-bottom: 1px solid #2a3444 !important;
    }
    /* Hide white separator bars in editor toolbar */
    [class*="EditorToolbar"] [class*="separator"],
    [class*="EditorToolbar"] [class*="Separator"],
    [class*="EditorToolbar"] [class*="divider"],
    [class*="EditorToolbar"] [class*="Divider"],
    [class*="editorToolbar"] [class*="separator"],
    [class*="editorToolbar"] [class*="Separator"] {
      background-color: #2a3444 !important;
      border-color: #2a3444 !important;
    }
    /* Catch any remaining white borders/separators in toolbars via broad selector */
    [class*="EditorToolbar"] div,
    [class*="editorToolbar"] div {
      border-color: #2a3444 !important;
    }

    /* Back navigation arrow */
    #nixvir-back-nav {
      position: fixed;
      top: 54px;
      left: 0;
      width: 195px;
      height: 36px;
      display: flex;
      align-items: center;
      padding: 0 14px;
      z-index: 10000;
      background: #111820;
      border-bottom: 1px solid #2a3444;
      border-right: 1px solid #2a3444;
      box-sizing: border-box;
      text-decoration: none !important;
      font-size: 12px;
      color: #9ca3b0 !important;
      gap: 6px;
      transition: background 0.15s, color 0.15s;
    }
    #nixvir-back-nav:hover {
      background: #1a2230 !important;
      color: #60a5fa !important;
    }
    #nixvir-back-nav svg { flex-shrink: 0; }

    /* Sidebar / navigation */
    [class*="Sidebar"],
    nav[class*="Nav"],
    aside {
      background: #111820 !important;
      border-right: 1px solid #2a3444 !important;
    }
    [class*="Sidebar"] a,
    [class*="Sidebar"] span {
      color: #9ca3b0 !important;
    }
    /* Sidebar: only highlight on hover or when truly active */
    [class*="Sidebar"] a:hover {
      color: #60a5fa !important;
      background: rgba(96, 165, 250, 0.1) !important;
    }
    /* Active sidebar item gets blue text + subtle bg */
    [class*="Sidebar"] a[class*="active"],
    [class*="Sidebar"] a[class*="Active"],
    [class*="Sidebar"] a[class*="selected"],
    [class*="Sidebar"] a[class*="Selected"] {
      color: #60a5fa !important;
      background: rgba(96, 165, 250, 0.15) !important;
    }
    /* Reset: non-active sidebar items should NOT have blue bg */
    [class*="Sidebar"] a:not([class*="active"]):not([class*="Active"]):not([class*="selected"]):not([class*="Selected"]):not(:hover) {
      background: transparent !important;
    }

    /* Main content area */
    [class*="MainView"],
    main,
    [class*="Content"] {
      background: #0a0e14 !important;
    }

    /* Collection top panel */
    [class*="CollectionTop"],
    [class*="ViewHeader"] {
      background: #111820 !important;
      border-color: #2a3444 !important;
    }
    [class*="CollectionTop"] h2,
    [class*="CollectionTop"] [class*="heading"],
    [class*="ViewHeader"] h2 {
      color: #e8ecf2 !important;
      font-size: 1.5em !important;
    }
    [class*="CollectionTop"] p,
    [class*="CollectionTop"] [class*="description"],
    [class*="ViewHeader"] p {
      color: #9ca3b0 !important;
    }

    /* Cards and panels */
    [class*="Card"],
    [class*="ListCard"],
    [class*="EntryListing"],
    [class*="ObjectControl"],
    [class*="ControlPane"],
    [class*="EditorControlPane"] {
      background: #111820 !important;
      border-color: #2a3444 !important;
    }

    /* Form fields and inputs */
    input, textarea, select {
      background: #1a2230 !important;
      color: #e8ecf2 !important;
      border-color: #2a3444 !important;
    }
    input:focus, textarea:focus, select:focus {
      border-color: #60a5fa !important;
      outline-color: #60a5fa !important;
    }
    input::placeholder, textarea::placeholder {
      color: #6b7280 !important;
    }

    /* Labels and headings */
    label, [class*="Label"], [class*="FieldLabel"] {
      color: #9ca3b0 !important;
    }
    /* Required field indicator — DecapCMS shows a colored bar on required fields.
       Could be border-left, a pseudo-element, or an inline element. Cover all cases. */
    /* Bar as border-left on field wrapper */
    #nc-root [class*="Field"][class*="required"],
    #nc-root [class*="field"][class*="required"],
    #nc-root [class*="ControlHint"],
    #nc-root [class*="FieldLabel"] {
      border-left-color: #3b82f6 !important;
    }
    /* Bar as pseudo-element on label */
    #nc-root label::before, #nc-root label::after,
    #nc-root [class*="Label"]::before, #nc-root [class*="Label"]::after,
    #nc-root [class*="FieldLabel"]::before, #nc-root [class*="FieldLabel"]::after {
      background-color: #3b82f6 !important;
      color: #3b82f6 !important;
    }
    /* Required indicator as inline span within label */
    #nc-root label span[class*="required"],
    #nc-root label span[class*="Required"],
    #nc-root [class*="Label"] span {
      color: #3b82f6 !important;
      background-color: transparent !important;
    }
    /* Catch any white/light border-left that DecapCMS applies as required indicator */
    #nc-root div[style*="border-left"],
    #nc-root div[style*="border-color: rgb(255"],
    #nc-root div[style*="border-color: white"] {
      border-left-color: #3b82f6 !important;
    }
    h1, h2, h3, h4, h5, h6 {
      color: #e8ecf2 !important;
    }

    /* All paragraph and span text */
    p, span, div {
      color: inherit;
    }

    /* Hint/help text below fields */
    [class*="hint"], [class*="Hint"], small {
      color: #8a919e !important;
    }

    /* Links */
    a {
      color: #60a5fa !important;
    }
    a:hover {
      color: #93bbfd !important;
    }

    /* Collection list items */
    [class*="ListItem"],
    [class*="EntryCard"] {
      background: #111820 !important;
      border-color: #2a3444 !important;
    }
    [class*="ListItem"]:hover,
    [class*="EntryCard"]:hover {
      background: #1a2230 !important;
    }
    [class*="ListItem"] span,
    [class*="ListItem"] a,
    [class*="ListItem"] div,
    [class*="EntryCard"] span,
    [class*="EntryCard"] a {
      color: #e8ecf2 !important;
    }

    /* Buttons */
    [class*="ToolbarButton"],
    button[class*="Button"] {
      color: #e8ecf2 !important;
    }

    /* Primary action buttons */
    [class*="PublishButton"] button,
    a[href*="new"] {
      background: #3b82f6 !important;
      color: #ffffff !important;
    }

    /* Markdown editor toolbar */
    [class*="Toolbar"],
    [class*="toolbar"] {
      background: #1a2230 !important;
      border-color: #2a3444 !important;
    }
    [class*="ToolbarButton"] {
      color: #9ca3b0 !important;
    }
    [class*="ToolbarButton"]:hover {
      color: #e8ecf2 !important;
      background: #2a3444 !important;
    }

    /* Markdown editor content area */
    [class*="RawEditor"],
    [class*="VisualEditor"],
    [class*="editor-preview"],
    [class*="CodeMirror"],
    .CodeMirror {
      background: #1a2230 !important;
      color: #e8ecf2 !important;
    }
    .CodeMirror-cursor {
      border-left-color: #e8ecf2 !important;
    }
    .CodeMirror-selected {
      background: #2a3444 !important;
    }
    .CodeMirror-gutters {
      background: #111820 !important;
      border-right-color: #2a3444 !important;
    }

    /* Preview pane */
    [class*="PreviewPane"],
    [class*="preview"] {
      background: #0a0e14 !important;
      color: #e8ecf2 !important;
    }

    /* Dropdown menus (including React-Select used by select widget) */
    [class*="Dropdown"],
    [class*="dropdown"],
    [class*="Menu"],
    [class*="menu"],
    ul[role="listbox"] {
      background: #1a2230 !important;
      border-color: #2a3444 !important;
    }
    [class*="DropdownItem"],
    [class*="option"],
    [class*="Option"],
    li[role="option"],
    div[role="option"] {
      background: #1a2230 !important;
      color: #e8ecf2 !important;
    }
    [class*="DropdownItem"]:hover,
    [class*="option"]:hover,
    [class*="Option"]:hover,
    li[role="option"]:hover,
    div[role="option"]:hover {
      background: #2a3444 !important;
      color: #ffffff !important;
    }
    /* React-Select: focused/selected option */
    [class*="option"][class*="focused"],
    [class*="option"][class*="Focused"],
    [class*="Option"][class*="focused"],
    [class*="Option"][class*="Focused"] {
      background: #2a3444 !important;
      color: #ffffff !important;
    }
    [class*="option"][class*="selected"],
    [class*="option"][class*="Selected"],
    [class*="Option"][class*="selected"],
    [class*="Option"][class*="Selected"] {
      background: #3b82f6 !important;
      color: #ffffff !important;
    }
    /* React-Select: single value display and placeholder */
    [class*="singleValue"],
    [class*="SingleValue"] {
      color: #e8ecf2 !important;
    }
    [class*="placeholder"],
    [class*="Placeholder"] {
      color: #6b7280 !important;
    }
    /* React-Select: control (the select box itself) */
    [class*="control"],
    [class*="Control"] {
      background: #1a2230 !important;
      border-color: #2a3444 !important;
    }
    [class*="indicatorSeparator"] {
      background-color: #2a3444 !important;
    }

    /* Status indicators */
    [class*="StatusBadge"],
    [class*="Draft"],
    [class*="workflow"] {
      border-color: #2a3444 !important;
    }

    /* =============================================
       Workflow page (Drafts / In Review / Ready)
       ============================================= */
    /* Workflow board background */
    [class*="Workflow"],
    [class*="workflow"] {
      background: #0a0e14 !important;
    }
    /* Column containers */
    [class*="WorkflowColumn"],
    [class*="BoardColumn"],
    [class*="Column"] {
      background: #111820 !important;
      border-color: #2a3444 !important;
    }
    /* Column headers — muted dark-theme versions of the status colors */
    [class*="ColumnHeader"],
    [class*="columnHeader"],
    [class*="BoardColumnHeader"] {
      border-color: #2a3444 !important;
    }
    /* Draft column header */
    [class*="ColumnHeader"]:first-child,
    [class*="Workflow"] div[class*="Column"]:nth-child(1) > div:first-child {
      background: #2d1f4e !important;
      color: #c4b5fd !important;
    }
    /* In Review column header */
    [class*="Workflow"] div[class*="Column"]:nth-child(2) > div:first-child {
      background: #3d2f0a !important;
      color: #fbbf24 !important;
    }
    /* Ready column header */
    [class*="Workflow"] div[class*="Column"]:nth-child(3) > div:first-child {
      background: #1a3a1a !important;
      color: #86efac !important;
    }
    /* Drop zones inside columns */
    [class*="WorkflowList"],
    [class*="BoardColumnContent"],
    [class*="ColumnContent"] {
      background: #0a0e14 !important;
      border-color: #2a3444 !important;
    }
    /* Workflow cards (entries inside columns) */
    [class*="WorkflowCard"],
    [class*="BoardCard"] {
      background: #1a2230 !important;
      border-color: #2a3444 !important;
    }
    [class*="WorkflowCard"]:hover,
    [class*="BoardCard"]:hover {
      background: #2a3444 !important;
    }

    /* =============================================
       Media library page
       ============================================= */
    [class*="MediaLibrary"],
    [class*="mediaLibrary"],
    [class*="MediaModal"],
    [class*="mediaModal"] {
      background: #0a0e14 !important;
    }
    /* Media grid header/toolbar */
    [class*="MediaLibraryTop"],
    [class*="MediaLibraryHeader"],
    [class*="mediaLibraryTop"] {
      background: #111820 !important;
      border-color: #2a3444 !important;
    }
    /* Media cards */
    [class*="MediaCard"],
    [class*="mediaCard"],
    [class*="CardGrid"] {
      background: #111820 !important;
    }
    [class*="MediaCard"],
    [class*="mediaCard"] {
      border-color: #2a3444 !important;
    }
    [class*="MediaCard"]:hover,
    [class*="mediaCard"]:hover {
      border-color: #60a5fa !important;
    }
    /* Media card text */
    [class*="MediaCard"] p,
    [class*="MediaCard"] span,
    [class*="mediaCard"] p,
    [class*="mediaCard"] span {
      color: #9ca3b0 !important;
    }
    /* Upload area / dropzone */
    [class*="Dropzone"],
    [class*="dropzone"],
    [class*="UploadArea"],
    [class*="uploadArea"] {
      background: #1a2230 !important;
      border-color: #2a3444 !important;
      color: #9ca3b0 !important;
    }
    /* Media folder breadcrumbs and nav */
    [class*="MediaBreadcrumb"],
    [class*="mediaBreadcrumb"] {
      color: #9ca3b0 !important;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #0a0e14; }
    ::-webkit-scrollbar-thumb { background: #2a3444; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #3a4454; }

    /* List widget (categories, tags) */
    [class*="ListControl"],
    [class*="SortableList"],
    [class*="NestedObjectLabel"] {
      background: #111820 !important;
      border-color: #2a3444 !important;
    }

    /* List widget "Add <item> +" button — ensure visibility */
    #nc-root [class*="ListControl"] > button,
    #nc-root [class*="ListControl"] [class*="TopBarButton"],
    #nc-root button[class*="TopBarButton"] {
      background: #1a2230 !important;
      color: #60a5fa !important;
      border: 1px dashed #3b82f6 !important;
      padding: 10px 16px !important;
      border-radius: 5px !important;
      font-size: 14px !important;
      cursor: pointer !important;
      margin-top: 8px !important;
    }
    #nc-root [class*="ListControl"] > button:hover,
    #nc-root [class*="ListControl"] [class*="TopBarButton"]:hover,
    #nc-root button[class*="TopBarButton"]:hover {
      background: #2a3444 !important;
      color: #93c5fd !important;
    }

    /* Toggle/boolean widget — ensure switch is visible */
    [class*="Toggle"] label {
      color: #9ca3b0 !important;
    }
    /* The toggle switch track (background) */
    #nc-root [class*="Toggle"] span,
    #nc-root [class*="toggle"] span,
    #nc-root label[class*="Switch"] span,
    #nc-root [class*="ToggleBackground"],
    #nc-root [class*="toggleBackground"] {
      background-color: #374151 !important;
      border-radius: 12px !important;
    }
    /* When toggle is checked/active — blue track */
    #nc-root input:checked + span,
    #nc-root input:checked ~ span,
    #nc-root [class*="Toggle"][class*="active"] span,
    #nc-root [class*="Toggle"][class*="Active"] span,
    #nc-root [class*="isActive"] span {
      background-color: #3b82f6 !important;
    }
    /* The toggle handle/knob */
    #nc-root [class*="Toggle"] span span,
    #nc-root [class*="toggle"] span span,
    #nc-root [class*="ToggleHandle"],
    #nc-root [class*="toggleHandle"] {
      background-color: #ffffff !important;
      border-radius: 50% !important;
    }
    /* Ensure boolean widget containers are visible and not collapsed */
    #nc-root [class*="Toggle"],
    #nc-root [class*="toggle"],
    #nc-root [id*="toggle"],
    #nc-root [class*="BooleanControl"],
    #nc-root [class*="booleanControl"],
    #nc-root [data-field-name="pinned"],
    #nc-root [data-field-name="active"] {
      min-height: 36px !important;
      display: flex !important;
      align-items: center !important;
    }
    /* Force checkbox inputs inside boolean widgets to be visible */
    #nc-root input[type="checkbox"] {
      appearance: auto !important;
      -webkit-appearance: checkbox !important;
      width: 18px !important;
      height: 18px !important;
      min-width: 18px !important;
      min-height: 18px !important;
      opacity: 1 !important;
      position: relative !important;
      cursor: pointer !important;
      accent-color: #3b82f6 !important;
      background: #1a2230 !important;
    }

    /* Dialog/modal overlays */
    [class*="Dialog"],
    [class*="Modal"],
    [class*="modal"] {
      background: #111820 !important;
      border-color: #2a3444 !important;
    }

    /* Netlify Identity widget dark override */
    .netlifyIdentityButton {
      background: #1a2230 !important;
      color: #e8ecf2 !important;
    }

    /* Override remaining white backgrounds */
    [style*="background: rgb(255"],
    [style*="background-color: rgb(255"],
    [style*="background: white"],
    [style*="background-color: white"],
    [style*="background:#fff"],
    [style*="background-color:#fff"] {
      background: #111820 !important;
    }

    div[class^="css-"] {
      border-color: #2a3444;
    }

    /* =============================================
       Nuclear dark theme: force ALL elements dark
       DecapCMS uses Emotion (random css-XXXX classes)
       so named selectors don't work. We use universal
       selectors and JS runtime fixes instead.
       ============================================= */

    /* Force every element to not have white/light backgrounds.
       Exempt toggle/boolean widgets so their styling is preserved. */
    #nc-root *:not([class*="Toggle"]):not([class*="toggle"]):not(input[type="checkbox"]),
    #nc-root *:not([class*="Toggle"]):not([class*="toggle"])::before,
    #nc-root *:not([class*="Toggle"]):not([class*="toggle"])::after {
      border-color: #2a3444 !important;
    }

    /* Target the CMS app root — all descendants get dark bg.
       Exempt toggle/boolean widgets AND dropdown menus from background override. */
    #nc-root div:not([class*="Toggle"]):not([class*="toggle"]):not([class*="Boolean"]):not([class*="boolean"]):not([class*="menu"]):not([class*="Menu"]):not([class*="option"]):not([class*="Option"]):not([role="listbox"]),
    #nc-root section,
    #nc-root aside,
    #nc-root main,
    #nc-root article,
    #nc-root footer,
    #nc-root header:not(:first-child) {
      background-color: #0a0e14;
    }

    /* Force dropdown menus to elevated surface — override nuclear rule */
    #nc-root div[class*="menu"],
    #nc-root div[class*="Menu"],
    #nc-root div[class*="MenuList"],
    #nc-root div[class*="menuList"],
    #nc-root div[role="listbox"],
    #nc-root div[class*="option"],
    #nc-root div[class*="Option"] {
      background-color: #1a2230 !important;
      z-index: 9999 !important;
    }

    /* Cards, panels, and elevated surfaces */
    #nc-root [class*="Card"],
    #nc-root [class*="card"],
    #nc-root [class*="Panel"],
    #nc-root [class*="panel"],
    #nc-root [class*="Control"],
    #nc-root [class*="Pane"],
    #nc-root [class*="Item"],
    #nc-root [class*="Entry"],
    #nc-root [class*="Object"],
    #nc-root [class*="List"],
    #nc-root [class*="TopBar"],
    #nc-root [class*="Nested"] {
      background-color: #111820 !important;
    }

    /* Input fields — slightly lighter elevated surface */
    #nc-root input,
    #nc-root textarea,
    #nc-root select,
    #nc-root [class*="editor"],
    #nc-root [class*="Editor"]:not([class*="EditorToolbar"]) {
      background-color: #1a2230 !important;
      color: #e8ecf2 !important;
    }

    /* All text inside the CMS */
    #nc-root span,
    #nc-root p,
    #nc-root label,
    #nc-root div,
    #nc-root li,
    #nc-root td,
    #nc-root th {
      color: #e8ecf2;
    }

    /* Buttons inside the CMS */
    #nc-root button {
      color: #e8ecf2 !important;
    }

    /* Hint text */
    #nc-root [class*="hint"],
    #nc-root [class*="Hint"],
    #nc-root small {
      color: #8a919e !important;
    }

    /* Preview pane (right side on editor) */
    #nc-root [class*="Preview"],
    #nc-root [class*="preview"] {
      background: #0a0e14 !important;
      color: #e8ecf2 !important;
    }
    #nc-root [class*="Preview"] *,
    #nc-root [class*="preview"] * {
      color: #e8ecf2 !important;
      background-color: transparent !important;
    }

    /* The header bar specifically */
    #nc-root > div > div:first-child,
    #nc-root header {
      background: #111820 !important;
    }

    /* Sort controls */
    [class*="SortControl"],
    [class*="ViewStyle"],
    [class*="sort"] button,
    [class*="Sort"] {
      color: #9ca3b0 !important;
    }

    /* Sidebar search */
    [class*="Sidebar"] input {
      background: #1a2230 !important;
      color: #e8ecf2 !important;
      border-color: #2a3444 !important;
    }

    /* =============================================
       NixVir Logo (fixed in header area)
       ============================================= */
    #nixvir-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      position: fixed;
      top: 0;
      left: 0;
      width: 195px;
      height: 52px;
      padding: 0 12px;
      z-index: 10000;
      text-decoration: none !important;
      background: #111820;
      border-bottom: 1px solid #2a3444;
      border-right: 1px solid #2a3444;
      box-sizing: border-box;
    }
    #nixvir-logo img {
      height: 32px;
      width: auto;
    }
    #nixvir-logo span {
      font-size: 13px;
      font-weight: 600;
      color: #9ca3b0 !important;
      letter-spacing: 0.3px;
      white-space: nowrap;
    }

    /* =============================================
       Logged-in user display (top-right, near identity icon)
       ============================================= */
    #nixvir-user-display {
      position: fixed;
      top: 0;
      right: 52px;
      height: 52px;
      display: flex;
      align-items: center;
      padding: 0 12px;
      font-size: 13px;
      color: #9ca3b0;
      z-index: 10000;
      pointer-events: none;
      white-space: nowrap;
    }

    /* =============================================
       Editor page instruction banner
       ============================================= */
    #nixvir-editor-banner {
      background: #111820;
      border: 1px solid #2a3444;
      border-radius: 6px;
      padding: 16px 20px;
      margin: 16px 20px 0 20px;
      display: none;
    }
    #nixvir-editor-banner h2 {
      color: #e8ecf2 !important;
      font-size: 18px;
      margin: 0 0 8px 0;
    }
    #nixvir-editor-banner p {
      color: #9ca3b0 !important;
      font-size: 13px;
      line-height: 1.5;
      margin: 0;
    }
    #nixvir-editor-banner .banner-steps {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    #nixvir-editor-banner .banner-step {
      display: flex;
      align-items: baseline;
      gap: 6px;
      font-size: 13px;
      color: #9ca3b0;
    }
    #nixvir-editor-banner .step-num {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #3b82f6;
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      flex-shrink: 0;
    }

    /* =============================================
       Help panel (floating bottom-right)
       ============================================= */
    #nixvir-help-panel {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 9999;
    }
    #nixvir-help-toggle {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #3b82f6 !important;
      color: #ffffff !important;
      border: none;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    #nixvir-help-toggle:hover {
      background: #2563eb !important;
    }
    #nixvir-help-content {
      display: none;
      position: absolute;
      bottom: 56px;
      right: 0;
      width: 400px;
      max-height: 70vh;
      overflow-y: auto;
      background: #111820;
      border: 1px solid #2a3444;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    #nixvir-help-content.open { display: block; }
    #nixvir-help-content h3 {
      color: #e8ecf2 !important;
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 16px;
      border-bottom: 1px solid #2a3444;
      padding-bottom: 8px;
    }
    #nixvir-help-content h4 {
      color: #60a5fa !important;
      margin: 14px 0 6px 0;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    #nixvir-help-content p,
    #nixvir-help-content li {
      color: #9ca3b0 !important;
      font-size: 13px;
      line-height: 1.5;
      margin: 4px 0;
    }
    #nixvir-help-content ul {
      padding-left: 18px;
      margin: 4px 0 10px 0;
    }
    #nixvir-help-content code {
      background: #1a2230;
      padding: 1px 5px;
      border-radius: 3px;
      font-size: 12px;
      color: #60a5fa !important;
    }
    #nixvir-help-content .help-section { margin-bottom: 16px; }
    #nixvir-help-content .help-section:last-child { margin-bottom: 0; }

    /* =============================================
       Editor form footer (Save button at bottom)
       ============================================= */
    #nixvir-editor-footer {
      padding: 24px 20px 40px 20px;
      text-align: center;
    }
    #nixvir-save-btn {
      display: inline-block;
      padding: 12px 48px;
      background: #3b82f6 !important;
      color: #ffffff !important;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      letter-spacing: 0.3px;
      transition: background 0.15s;
    }
    #nixvir-save-btn:hover {
      background: #2563eb !important;
    }
    #nixvir-save-btn:active {
      background: #1d4ed8 !important;
    }
    #nixvir-editor-footer p {
      color: #8a919e !important;
      font-size: 12px;
      margin-top: 8px;
    }

    /* =============================================
       Manual news: constrain Body editor height
       (data-collection attribute set by JS)
       ============================================= */
    #nc-root[data-collection="manual-news"] .CodeMirror {
      min-height: 60px !important;
      max-height: 100px !important;
      height: 60px !important;
    }
    #nc-root[data-collection="manual-news"] [class*="RawEditor"],
    #nc-root[data-collection="manual-news"] [class*="VisualEditor"],
    #nc-root[data-collection="manual-news"] [class*="editor-preview"] {
      min-height: 60px !important;
      max-height: 100px !important;
    }
    /* Ensure hint text below body is not clipped */
    #nc-root[data-collection="manual-news"] [class*="hint"],
    #nc-root[data-collection="manual-news"] [class*="Hint"],
    #nc-root[data-collection="manual-news"] small {
      display: block !important;
      visibility: visible !important;
      overflow: visible !important;
    }
  </style>
</head>
<body>
  <script src="https://unpkg.com/decap-cms@3.9.0/dist/decap-cms.js"></script>
  <script>
    (function() {
      var lastUrl = '';

      // --- Context-sensitive help content ---
      function getHelpForContext() {
        var hash = window.location.hash || '';
        var isManualNews = hash.includes('manual-news');
        var isWorkflow = hash.includes('/workflow');
        var isMedia = hash.includes('/media');
        var isNewPost = hash.includes('/collections/post') && hash.includes('/new');
        var isEditPost = hash.includes('/collections/post') && hash.includes('/entries/') && !hash.includes('/new');
        var isPostListing = hash.includes('/collections/post') && !hash.includes('/new') && !hash.includes('/entries/');

        if (isManualNews) {
          return {
            title: 'Manual News Stories Help',
            sections: [
              { heading: 'Adding a Story', items: [
                'Click <strong>New Ski News — Manual Stories</strong> at the top to create a new entry',
                'Fill in <strong>Title</strong>, <strong>Story URL</strong>, <strong>Source</strong>, and <strong>Category</strong> at minimum',
                'Click <strong>Submit for Publishing</strong> at the bottom of the form',
                'The story appears on the Ski News page after the site rebuilds (a few minutes)'
              ]},
              { heading: 'Field Guide', items: [
                '<strong>Story Title</strong> — The headline as it appears in the news feed',
                '<strong>Story URL</strong> — Full link to the article, podcast, or video',
                '<strong>Source Name</strong> — Publication or channel (e.g. "Powder Magazine")',
                '<strong>Category</strong> — Topic area. Use "Podcast / Video" for media content',
                '<strong>Content Type</strong> — Article, Podcast, or Video. Podcasts/videos show a special icon',
                '<strong>Description</strong> — Optional 1-2 sentence summary shown below the headline',
                '<strong>Publication Date</strong> — When the story was originally published. Click "Now" for today',
                '<strong>Pin Duration</strong> — How long the story stays pinned at the top of the feed (default: 3 days from publication date)',
                '<strong>Active</strong> — Uncheck to hide a story without deleting it'
              ]},
              { heading: 'Tips', items: [
                'Manual entries merge with the automated RSS feed on the Ski News page',
                'Click any story title in the list to edit it',
                'Each story goes through the same workflow as blog posts: Draft → Ready → Publish',
                'Published stories appear on the site after the next build (a few minutes)'
              ]}
            ]
          };
        }

        if (isWorkflow) {
          return {
            title: 'Editorial Workflow Help',
            sections: [
              { heading: 'How It Works', items: [
                'This board tracks <strong>all content</strong> (Data Insights and Manual News) through the publishing process',
                'Saved drafts from both collections appear here',
                'Drag posts between columns or change status in the editor dropdown'
              ]},
              { heading: 'Columns', items: [
                '<strong>Drafts</strong> — Work in progress. Created when you first Save a post',
                '<strong>In Review</strong> — Ready for a second look before publishing',
                '<strong>Ready</strong> — Approved to go live. Click the post and hit Publish'
              ]},
              { heading: 'Tips', items: [
                'Click a post card to open it in the editor',
                'Use the status dropdown at the top of the editor to change status',
                'Publishing merges changes into the live site automatically'
              ]}
            ]
          };
        }

        if (isMedia) {
          return {
            title: 'Media Library Help',
            sections: [
              { heading: 'About', items: [
                'This page shows all images stored on the site',
                'Images are used in <strong>Data Insight blog posts</strong>',
                'This page is not needed for manual news stories'
              ]},
              { heading: 'Uploading Images', items: [
                'Drag and drop a file onto this page, or click the Upload button',
                'You can also upload images directly from the blog post editor using the <strong>+</strong> button'
              ]},
              { heading: 'Warning', items: [
                '<strong style="color:#f87171;">Do not delete images</strong> unless you are certain nothing on the site references them',
                'Site logos, icons, banner images, and post images all live here'
              ]}
            ]
          };
        }

        if (isNewPost) {
          return {
            title: 'Create a New Data Insight',
            sections: [
              { heading: 'Steps', items: [
                'Fill in <strong>Title</strong>, <strong>Publish Date</strong>, and <strong>Body</strong> (required)',
                'Other fields (slug, categories, tags, description, image) are optional',
                'Scroll down to the <strong>Body</strong> field to write your content',
                'Click <strong>Submit for Publishing</strong> at the bottom of the form'
              ]},
              { heading: 'Field Guide', items: [
                '<strong>Title</strong> — The headline readers see. Required',
                '<strong>Publish Date</strong> — When the post appears dated. Click "Now" for today',
                '<strong>URL Slug</strong> — The URL path. Leave blank to auto-generate. Example: <code>winter-outlook-2026</code>',
                '<strong>Categories</strong> — Topic grouping. Usually just one. Common: <code>ski-industry</code>, <code>economics</code>, <code>climate</code>',
                '<strong>Tags</strong> — Optional finer keywords. Can leave empty',
                '<strong>Description</strong> — SEO summary. Auto-generated if blank',
                '<strong>Featured Image</strong> — Banner image. Optional',
                '<strong>Body</strong> — The main content. Use the toolbar for formatting'
              ]},
              { heading: 'Tips', items: [
                'Toggle between rich text and raw Markdown in the Body editor',
                'Posts appear at <code>nixvir.com/post/your-slug/</code>'
              ]}
            ]
          };
        }

        if (isEditPost) {
          return {
            title: 'Edit Data Insight',
            sections: [
              { heading: 'Editing', items: [
                'Make your changes in the fields below',
                'Click <strong>Submit for Publishing</strong> at the bottom when done',
                'Your changes are saved and marked ready for publishing automatically'
              ]},
              { heading: 'Publishing', items: [
                'The <strong>Submit for Publishing</strong> button saves and sets the status to Ready in one step',
                'The <strong>Workflow</strong> tab shows all posts by status'
              ]},
              { heading: 'Tips', items: [
                'Toggle between rich text and raw Markdown in the Body editor',
                'Use the <strong>+</strong> button in the Body toolbar to insert images'
              ]}
            ]
          };
        }

        // Default: Data Insights listing or home
        return {
          title: 'Data Insights Help',
          sections: [
            { heading: 'Getting Started', items: [
              'Click <strong>Add New Data Insight</strong> to create a blog post',
              'Click any post title in the list below to edit it',
              'Posts go through a workflow: <strong>Draft → In Review → Ready → Published</strong>'
            ]},
            { heading: 'Other Sections', items: [
              '<strong>Ski News — Manual Stories</strong> (sidebar) — Add articles, podcasts, or videos to the Ski News feed',
              '<strong>Workflow</strong> (top nav) — Track blog posts through the publishing pipeline',
              '<strong>Media</strong> (top nav) — Manage images used in blog posts'
            ]},
            { heading: 'Tips', items: [
              'Posts appear at <code>nixvir.com/post/your-slug/</code>',
              'The Data Insights page at <code>nixvir.com/post/</code> lists all published posts',
              'Bookmark <code>nixvir.com/admin/</code> to return here anytime'
            ]}
          ]
        };
      }

      function updateHelpContent() {
        var el = document.getElementById('nixvir-help-content');
        if (!el) return;
        var ctx = getHelpForContext();
        var html = '<h3>' + ctx.title + '</h3>';
        ctx.sections.forEach(function(sec) {
          html += '<div class="help-section"><h4>' + sec.heading + '</h4><ul>';
          sec.items.forEach(function(item) { html += '<li>' + item + '</li>'; });
          html += '</ul></div>';
        });
        el.innerHTML = html;
      }

      function injectNixvirUI() {
        // --- Logo (once) — links to admin root ---
        if (!document.getElementById('nixvir-logo')) {
          var logo = document.createElement('a');
          logo.id = 'nixvir-logo';
          logo.href = '/admin/';
          logo.title = 'Content Manager Home';
          logo.innerHTML = '<img src="/images/nixvirlogo.png" alt="NixVir">' +
                           '<span>Content Manager</span>';
          document.body.appendChild(logo);
        }

        // --- Back navigation arrow (context-aware) ---
        var backNav = document.getElementById('nixvir-back-nav');
        var currentHash = window.location.hash || '';
        var isSubPage = currentHash.includes('/entries/') || currentHash.includes('/new') ||
                        currentHash.includes('/workflow') || currentHash.includes('/media');

        if (isSubPage) {
          if (!backNav) {
            backNav = document.createElement('a');
            backNav.id = 'nixvir-back-nav';
            backNav.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>' +
                                '<span>Back to Dashboard</span>';
            document.body.appendChild(backNav);
          }
          if (currentHash.includes('manual-news')) {
            backNav.href = '#/collections/manual-news';
          } else if (currentHash.includes('/collections/post')) {
            backNav.href = '#/collections/post';
          } else {
            backNav.href = '#/collections/post';
          }
        } else if (backNav) {
          backNav.remove();
        }

        // --- Help Panel (once) ---
        if (!document.getElementById('nixvir-help-panel')) {
          var helpPanel = document.createElement('div');
          helpPanel.id = 'nixvir-help-panel';
          helpPanel.innerHTML =
            '<button id="nixvir-help-toggle" title="Help &amp; Instructions">?</button>' +
            '<div id="nixvir-help-content"></div>';

          document.body.appendChild(helpPanel);

          document.getElementById('nixvir-help-toggle').addEventListener('click', function() {
            var content = document.getElementById('nixvir-help-content');
            content.classList.toggle('open');
            this.textContent = content.classList.contains('open') ? '\u2715' : '?';
            if (content.classList.contains('open')) updateHelpContent();
          });

          document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
              var content = document.getElementById('nixvir-help-content');
              if (content && content.classList.contains('open')) {
                content.classList.remove('open');
                document.getElementById('nixvir-help-toggle').textContent = '?';
              }
            }
          });
        }

        // Update help content if panel is open (route may have changed)
        var helpContent = document.getElementById('nixvir-help-content');
        if (helpContent && helpContent.classList.contains('open')) updateHelpContent();

        // --- Show logged-in user name near identity widget ---
        if (!document.getElementById('nixvir-user-display') && window.netlifyIdentity) {
          var user = window.netlifyIdentity.currentUser();
          if (user) {
            var name = (user.user_metadata && user.user_metadata.full_name) || user.email || '';
            if (name) {
              var userDisplay = document.createElement('div');
              userDisplay.id = 'nixvir-user-display';
              userDisplay.textContent = name;
              document.body.appendChild(userDisplay);
            }
          }
        }

        // --- Rename "New Data Insights" button to "Add New Data Insight" ---
        document.querySelectorAll('a[href*="new"]').forEach(function(el) {
          if (el.textContent.trim() === 'New Data Insights') {
            el.textContent = 'Add New Data Insight';
          }
        });

        // --- Fix sidebar highlighting ---
        // DecapCMS may apply active styles to the wrong sidebar item.
        // We enforce correct highlighting based on the current URL hash.
        var sidebarLinks = document.querySelectorAll('[class*="Sidebar"] a, aside a, nav a');
        sidebarLinks.forEach(function(link) {
          var href = link.getAttribute('href') || '';
          // Check if this link matches the current route
          var isActive = false;
          if (currentHash.includes('manual-news') && href.includes('manual-news')) {
            isActive = true;
          } else if (currentHash.includes('/collections/post') && href.includes('/collections/post') && !href.includes('manual-news')) {
            isActive = true;
          } else if (!currentHash.includes('manual-news') && !currentHash.includes('/collections/post') && href.includes('/collections/post')) {
            // Default to Data Insights on the home/collections view
            isActive = currentHash === '' || currentHash === '#' || currentHash.includes('/collections/post');
          }

          if (isActive) {
            link.style.setProperty('color', '#60a5fa', 'important');
            link.style.setProperty('background', 'rgba(96, 165, 250, 0.15)', 'important');
          } else {
            link.style.setProperty('color', '#9ca3b0', 'important');
            link.style.setProperty('background', 'transparent', 'important');
          }
        });

        // --- Runtime dark theme enforcement ---
        // Emotion injects styles AFTER page load, overriding our CSS.
        // This finds any element with a light background and forces it dark.
        var ncRoot = document.getElementById('nc-root');
        if (ncRoot) {
          var allEls = ncRoot.querySelectorAll('div, section, aside, main, footer, ul, li, span');
          for (var i = 0; i < allEls.length; i++) {
            var el = allEls[i];
            var bg = window.getComputedStyle(el).backgroundColor;
            if (bg && bg !== 'transparent' && bg !== 'rgba(0, 0, 0, 0)') {
              var match = bg.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
              if (match) {
                var r = parseInt(match[1]), g = parseInt(match[2]), b = parseInt(match[3]);
                if ((r + g + b) / 3 > 180) {
                  el.style.setProperty('background-color', '#111820', 'important');
                }
              }
            }
          }
        }

        // --- Check if on manual news route (used by banner below) ---
        var isNews = window.location.hash.includes('manual-news');

        // --- Set data-collection attribute for collection-specific CSS ---
        var ncRootForAttr = document.getElementById('nc-root');
        if (ncRootForAttr) {
          if (isNews) {
            ncRootForAttr.setAttribute('data-collection', 'manual-news');
          } else if (window.location.hash.includes('/collections/post')) {
            ncRootForAttr.setAttribute('data-collection', 'post');
          } else {
            ncRootForAttr.removeAttribute('data-collection');
          }
        }

        // --- Editor page: inject instruction banner ---
        var isEditorPage = window.location.hash.includes('/collections/') &&
                           (window.location.hash.includes('/new') || window.location.hash.includes('/entries/'));
        var banner = document.getElementById('nixvir-editor-banner');

        if (isEditorPage) {
          var controlPane = document.querySelector('[class*="ControlPane"], [class*="controlPane"]');
          if (controlPane && !banner) {
            banner = document.createElement('div');
            banner.id = 'nixvir-editor-banner';
            banner.style.display = 'block';

            var isNew = window.location.hash.includes('/new');
            var title, instructions, stepsHtml;

            if (isNews && isNew) {
              title = 'Add a Story to the News Feed';
              instructions = 'Fill in the Title, Story URL, Source, and Category at minimum. Pin Duration defaults to 3 days.';
              stepsHtml =
                '<div class="banner-step"><span class="step-num">1</span> Fill in the fields below</div>' +
                '<div class="banner-step"><span class="step-num">2</span> Click <strong>Submit for Publishing</strong> at the bottom</div>';
            } else if (isNews) {
              title = 'Edit News Story';
              instructions = 'Make your changes below.';
              stepsHtml =
                '<div class="banner-step"><span class="step-num">1</span> Edit the fields below</div>' +
                '<div class="banner-step"><span class="step-num">2</span> Click <strong>Submit for Publishing</strong> at the bottom</div>';
            } else if (isNew) {
              title = 'Create a New Data Insight';
              instructions = 'Only Title, Date, and Body are required.';
              stepsHtml =
                '<div class="banner-step"><span class="step-num">1</span> Fill in the fields below</div>' +
                '<div class="banner-step"><span class="step-num">2</span> Click <strong>Submit for Publishing</strong> at the bottom</div>';
            } else {
              title = 'Edit Data Insight';
              instructions = 'Make your changes below.';
              stepsHtml =
                '<div class="banner-step"><span class="step-num">1</span> Edit the fields below</div>' +
                '<div class="banner-step"><span class="step-num">2</span> Click <strong>Submit for Publishing</strong> at the bottom</div>';
            }

            banner.innerHTML =
              '<h2>' + title + '</h2>' +
              '<p>' + instructions + '</p>' +
              '<div class="banner-steps">' + stepsHtml + '</div>';

            controlPane.parentNode.insertBefore(banner, controlPane);
          }
        } else if (banner) {
          banner.style.display = 'none';
        }

        // --- Editor page: inject "Submit for Publishing" button at bottom ---
        var footer = document.getElementById('nixvir-editor-footer');
        if (isEditorPage) {
          if (!footer) {
            // Find all label elements, then walk up to the scrollable form container.
            var labels = document.querySelectorAll('#nc-root label');
            if (labels.length >= 3) {
              var lastLabel = labels[labels.length - 1];
              var formContainer = null;
              var el = lastLabel.parentElement;
              for (var attempts = 0; el && attempts < 15; attempts++) {
                var overflow = window.getComputedStyle(el).overflowY;
                if (overflow === 'auto' || overflow === 'scroll') {
                  formContainer = el;
                  break;
                }
                el = el.parentElement;
              }
              if (!formContainer) {
                formContainer = lastLabel.parentElement && lastLabel.parentElement.parentElement
                  ? lastLabel.parentElement.parentElement : null;
              }
              if (formContainer) {
                footer = document.createElement('div');
                footer.id = 'nixvir-editor-footer';
                footer.innerHTML =
                  '<button id="nixvir-save-btn" type="button">Submit for Publishing</button>' +
                  '<p>Saves your entry and marks it ready for publishing.</p>';
                formContainer.appendChild(footer);

                document.getElementById('nixvir-save-btn').addEventListener('click', function() {
                  var btn = this;
                  btn.disabled = true;
                  btn.textContent = 'Saving\u2026';
                  btn.style.opacity = '0.7';

                  // Step 1: Click the CMS native Save button
                  var saveBtnFound = false;
                  var allBtns = document.querySelectorAll('#nc-root button');
                  for (var i = 0; i < allBtns.length; i++) {
                    var txt = allBtns[i].textContent.trim().toLowerCase();
                    if (txt === 'save' && allBtns[i].id !== 'nixvir-save-btn') {
                      allBtns[i].click();
                      saveBtnFound = true;
                      break;
                    }
                  }
                  if (!saveBtnFound) {
                    btn.textContent = 'Submit for Publishing';
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    return;
                  }

                  // Step 2: Poll for status dropdown, then set to Ready
                  btn.textContent = 'Setting status\u2026';
                  var statusAttempts = 0;
                  var statusInterval = setInterval(function() {
                    statusAttempts++;
                    // Look for the status/draft button in the toolbar
                    var toolbarBtns = document.querySelectorAll('#nc-root button');
                    for (var j = 0; j < toolbarBtns.length; j++) {
                      var btnText = toolbarBtns[j].textContent.trim().toLowerCase();
                      if (btnText === 'draft' || btnText === 'in review' || btnText.includes('set status')) {
                        toolbarBtns[j].click();
                        // After dropdown opens, find and click "Ready"
                        setTimeout(function() {
                          var items = document.querySelectorAll('#nc-root li, #nc-root [role="option"], #nc-root [class*="DropdownItem"]');
                          for (var k = 0; k < items.length; k++) {
                            if (items[k].textContent.trim().toLowerCase() === 'ready') {
                              items[k].click();
                              break;
                            }
                          }
                          btn.textContent = 'Submitted!';
                          btn.style.background = '#22c55e';
                          setTimeout(function() {
                            btn.textContent = 'Submit for Publishing';
                            btn.style.background = '';
                            btn.disabled = false;
                            btn.style.opacity = '1';
                          }, 2000);
                        }, 500);
                        clearInterval(statusInterval);
                        return;
                      }
                    }
                    if (statusAttempts >= 20) {
                      clearInterval(statusInterval);
                      btn.textContent = 'Saved (set status manually)';
                      btn.disabled = false;
                      btn.style.opacity = '1';
                      setTimeout(function() {
                        btn.textContent = 'Submit for Publishing';
                      }, 3000);
                    }
                  }, 500);
                });
              }
            }
          }
        } else if (footer) {
          footer.remove();
        }

        // --- Runtime fix: boolean widget visibility ---
        // DecapCMS renders boolean as hidden checkbox + custom toggle.
        // Emotion CSS-in-JS hides the checkbox. Force it visible.
        if (isEditorPage) {
          var checkboxes = document.querySelectorAll('#nc-root input[type="checkbox"]');
          for (var cb = 0; cb < checkboxes.length; cb++) {
            var checkbox = checkboxes[cb];
            checkbox.style.setProperty('opacity', '1', 'important');
            checkbox.style.setProperty('position', 'relative', 'important');
            checkbox.style.setProperty('width', '20px', 'important');
            checkbox.style.setProperty('height', '20px', 'important');
            checkbox.style.setProperty('min-width', '20px', 'important');
            checkbox.style.setProperty('min-height', '20px', 'important');
            checkbox.style.setProperty('cursor', 'pointer', 'important');
            checkbox.style.setProperty('accent-color', '#3b82f6', 'important');
            checkbox.style.setProperty('appearance', 'auto', 'important');
            checkbox.style.setProperty('-webkit-appearance', 'checkbox', 'important');
            // Add visible On/Off label if not already present
            var parentLabel = checkbox.closest('label');
            if (parentLabel && !parentLabel.querySelector('.nixvir-bool-label')) {
              var stateLabel = document.createElement('span');
              stateLabel.className = 'nixvir-bool-label';
              stateLabel.style.cssText = 'margin-left:8px; font-size:13px; color:#9ca3b0;';
              stateLabel.textContent = checkbox.checked ? 'On' : 'Off';
              parentLabel.appendChild(stateLabel);
              checkbox.addEventListener('change', function() {
                var lbl = this.closest('label');
                if (lbl) {
                  var sl = lbl.querySelector('.nixvir-bool-label');
                  if (sl) sl.textContent = this.checked ? 'On' : 'Off';
                }
              });
            }
          }
        }

        // --- Runtime fix: recolor required-field indicator bars ---
        if (isEditorPage) {
          var fieldDivs = document.querySelectorAll('#nc-root div');
          for (var d = 0; d < fieldDivs.length; d++) {
            var divEl = fieldDivs[d];
            var cs = window.getComputedStyle(divEl);
            var blWidth = parseInt(cs.borderLeftWidth) || 0;
            if (blWidth >= 2 && blWidth <= 6) {
              var blColor = cs.borderLeftColor;
              var blMatch = blColor.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
              if (blMatch) {
                var blR = parseInt(blMatch[1]), blG = parseInt(blMatch[2]), blB = parseInt(blMatch[3]);
                if ((blR + blG + blB) / 3 > 180) {
                  divEl.style.setProperty('border-left-color', '#3b82f6', 'important');
                }
              }
            }
          }
        }

        // --- Workflow page: inject info banner ---
        var isWorkflowPage = window.location.hash.includes('/workflow') || window.location.hash === '#/workflow';
        var wfBanner = document.getElementById('nixvir-workflow-banner');
        if (isWorkflowPage && !wfBanner) {
          // Find where to insert — look for the workflow heading or first major container
          var workflowContainer = document.querySelector('[class*="Workflow"], [class*="workflow"]');
          if (workflowContainer) {
            wfBanner = document.createElement('div');
            wfBanner.id = 'nixvir-workflow-banner';
            wfBanner.style.cssText = 'background:#111820; border:1px solid #2a3444; border-radius:6px; ' +
              'padding:16px 20px; margin:16px 20px; max-width:900px;';
            wfBanner.innerHTML =
              '<h2 style="color:#e8ecf2; font-size:18px; margin:0 0 8px 0;">Editorial Workflow</h2>' +
              '<p style="color:#9ca3b0; font-size:13px; line-height:1.6; margin:0 0 10px 0;">' +
                'This board tracks <strong style="color:#e8ecf2;">all content</strong> (Data Insights and Manual News stories) as it moves through the publishing process. ' +
                'Saved drafts appear in the <strong style="color:#c4b5fd;">Drafts</strong> column below.' +
              '</p>' +
              '<p style="color:#9ca3b0; font-size:13px; line-height:1.6; margin:0 0 10px 0;">' +
                'When you create or edit a Data Insight post and click Save, it appears in the <strong style="color:#c4b5fd;">Drafts</strong> column. ' +
                'Change its status to move it across columns:' +
              '</p>' +
              '<div style="display:flex; gap:16px; flex-wrap:wrap; margin-top:8px;">' +
                '<div style="font-size:13px; color:#c4b5fd; background:#2d1f4e; padding:6px 12px; border-radius:4px;">Drafts — Work in progress</div>' +
                '<div style="font-size:13px; color:#9ca3b0;">→</div>' +
                '<div style="font-size:13px; color:#fbbf24; background:#3d2f0a; padding:6px 12px; border-radius:4px;">In Review — Ready for a second look</div>' +
                '<div style="font-size:13px; color:#9ca3b0;">→</div>' +
                '<div style="font-size:13px; color:#86efac; background:#1a3a1a; padding:6px 12px; border-radius:4px;">Ready — Approved to go live</div>' +
              '</div>' +
              '<p style="color:#9ca3b0; font-size:13px; line-height:1.6; margin:10px 0 0 0;">' +
                'Once a post is in <strong style="color:#86efac;">Ready</strong>, click on it and hit <strong style="color:#e8ecf2;">Publish</strong> to make it live on the site.' +
              '</p>';
            workflowContainer.parentNode.insertBefore(wfBanner, workflowContainer);
          }
        } else if (!isWorkflowPage && wfBanner) {
          wfBanner.remove();
        }

        // --- Media page: inject info banner ---
        var isMediaPage = window.location.hash.includes('/media') || window.location.hash === '#/media';
        var mediaBanner = document.getElementById('nixvir-media-banner');
        if (isMediaPage && !mediaBanner) {
          var mediaContainer = document.querySelector('[class*="MediaLibrary"], [class*="mediaLibrary"], [class*="Media"]');
          if (mediaContainer) {
            mediaBanner = document.createElement('div');
            mediaBanner.id = 'nixvir-media-banner';
            mediaBanner.style.cssText = 'background:#111820; border:1px solid #2a3444; border-radius:6px; ' +
              'padding:16px 20px; margin:16px 20px; max-width:900px;';
            mediaBanner.innerHTML =
              '<h2 style="color:#e8ecf2; font-size:18px; margin:0 0 8px 0;">Media Library</h2>' +
              '<p style="color:#9ca3b0; font-size:13px; line-height:1.6; margin:0 0 10px 0;">' +
                'This page shows all images stored on the site. It is used when writing ' +
                '<strong style="color:#e8ecf2;">Data Insight blog posts</strong> that include images.' +
              '</p>' +
              '<p style="color:#9ca3b0; font-size:13px; line-height:1.6; margin:0 0 10px 0;">' +
                '<strong style="color:#e8ecf2;">To add an image to a blog post:</strong> You don\'t need to come here first. ' +
                'When editing a post, click the <strong style="color:#e8ecf2;">+</strong> button in the Body editor toolbar ' +
                'to upload and insert an image directly.' +
              '</p>' +
              '<p style="color:#9ca3b0; font-size:13px; line-height:1.6; margin:0 0 10px 0;">' +
                '<strong style="color:#e8ecf2;">To upload a new image:</strong> Drag and drop a file onto this page, or click the Upload button.' +
              '</p>' +
              '<p style="color:#f87171; font-size:13px; line-height:1.6; margin:0;">' +
                '<strong>Do not delete images from here</strong> unless you are certain nothing on the site references them. ' +
                'Site logos, icons, banner images, and post images all live in this library. ' +
                'This page is not needed for manual news stories.' +
              '</p>';
            mediaContainer.parentNode.insertBefore(mediaBanner, mediaContainer);
          }
        } else if (!isMediaPage && mediaBanner) {
          mediaBanner.remove();
        }
      }

      // Poll for CMS render and route changes
      function startPolling() {
        setInterval(function() {
          var currentUrl = window.location.hash;
          if (currentUrl !== lastUrl) {
            lastUrl = currentUrl;
            // Remove old banners on navigation
            var oldBanner = document.getElementById('nixvir-editor-banner');
            if (oldBanner) oldBanner.remove();
            var oldWfBanner = document.getElementById('nixvir-workflow-banner');
            if (oldWfBanner) oldWfBanner.remove();
            var oldMediaBanner = document.getElementById('nixvir-media-banner');
            if (oldMediaBanner) oldMediaBanner.remove();
            var oldFooter = document.getElementById('nixvir-editor-footer');
            if (oldFooter) oldFooter.remove();
          }
          injectNixvirUI();
        }, 500);
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(startPolling, 1000);
        });
      } else {
        setTimeout(startPolling, 1000);
      }
    })();
  </script>
</body>
</html>
